# TypeScript+three.jsによる基本プロジェクト

## 概要

- WebGLの練習用リポジトリです。
	- TypeScript+Webpack導入と、npm run deployまでのセットアップなど環境整備のサンプルとしても。

- WebGL操作ライブラリにはthree.jsを選択しました。

- webpackでTypeScript導入。
	- npm installのあとは、npm run devでローカルサーバ起動します。

- デプロイは`npm run deploy`、S3へのデプロイに必要な機密情報はリポジトリに含んでいません。

- リポジトリ  
	https://github.com/nonchang-net/20180304_webglTest

- 動作サンプル  
	http://nonchang.net/test/webgl/


## ライセンスとか

個人の練習用リポジトリなので転載などはご容赦ください。  
なんか有益なものができたらMIT記載でリポジトリ分けます。


## 目標

- 簡単なゲーム作成まではやりたい。
	- 取り急ぎは、過去にUnityで作ってみてた「NRogue」のコードを参考に、ランダムダンジョンの作成を試したい。
	- TypeScriptによるタッチイベント処理の基本や、フロートHTMLでの画面制御などを試していきたい。

- ただ、今時感のある「見栄えのするシンプルなゲーム」はダンジョンゲームではないと思うので、アイデアは随時検討していく。


## TODO

- 基本的なところ

	- ドラッグの感度がピクセルなのは良くない。
		- どんなサイズの端末でも、画面表示に対応する操作感にしたい。

	- 今は画面の縦サイズを維持してカメラがスケールしているので、縦解像度でピクセルを割れば端末異存がないのではと思う。
		- ※この判断は、大画面PCでは大きなマウス操作が必要になる、という判断。
			- 考え方次第では、「setPixelRatio」に渡す引数「devicePixelRatio」をみても良さそう。
				- これを使えば、iPadでもiPhoneでもスワイプサイズは同等……という操作性を維持できる？
				- iPadないからなぁ。
			- これはまあ`後日検討`で別項目にして問題ないかと。スクラムだと後回しストーリーにする感じ。
			- 理解が早い方に寄せる判断とも言える。

- デプロイ周り
	- 毎回assetsをアップし直してるのが気になる……。exact-timestamps外しても一緒か。。
		- 不要な更新はできれば避けたい。この辺は規模が大きくなるまでは無視して良さそうだけど。

- stats.js導入
	- https://github.com/mrdoob/stats.js
	- プロファイラは早めに導入しておきたい。
	- http://tmlife.net/programming/javascript/lasted-stats-js-usage.html
	- あ、これMr.doobの作品なんだw AS3でもお世話になったなぁ……。

- UIの作成方法を検討していく

- 手馴しにNRogueのコードを移植していく

- ゲームとしての体裁を整える
	- とりあえずRPGではなくゴール探すだけのゲームにするかな……。

- BGM
	- mp3でもいいんだけど、Web Audio APIでシンセサイズ+MML再生とか試して見たいかなぁ。
		- ダウンロードマネージャとか作りたくない。

- 3Dゲームの地盤としてのライブラリ整備



## 日別ログ

触った時の日記。上が新しく、古いものは随時月別ログとしてまとめて見る方向で記述。

### 20180325日曜日

- しばらく別プロジェクトでイベント設計などを進めてた。
	- そろそろ画面作りたくなってきたので、こちらのコードをリファクタしていく。

- なんとか壁を並べて、カーソルキーで当たり判定を無視して歩き回れるようにはなった。
	- 左右で回してると謎の回転が起こる。……ジンバルロックか何か？ 軸を処理できなくなったかのような動き。なんだろ？
	- っと、これは縦回転のdampingが悪さしてた……。

- 00:49、iPhoneで触れるようにデプロイして置いた。
	- 取り急ぎ、ドラッグで回転・上下移動自体はできるようにしてみた。
		- しかし想像はしてたけど、操作性はものすごく悪いw
	- 多分タップで前進・左右回転はできるようにしなきゃいけない。スワイプで回転してもいいけど、それは多分ユーザビリティーには繋がらないと思う。

- `TODO`
	- 横方向で画角を決めたい。
		つまり、iPhoneXのように縦長すぎても、横幅はちゃんと自分の左右の壁が見えている画角にしたい。
	- 床追加
	- テクスチャ差し替え。
		- フリー素材を自前で探しておく。
			- 権利クリアなものをしっかり控える。
		- NPOTに加工しておく。512x512あればいいかな……？1024にしとく？
		- できれば継ぎ目のないリピート素材が欲しいな……。
			- そんな特別な要求ではないと思うのだけども、多分。


### 20180305月曜日

- ちまちまと基盤整備。
	- height matchなのでheight方向の長さをreferenceとして扱うようにしてドラッグ感度を調節。

- 「SampleMazeFactory」を作成。
	- なんとなくmazeの生成種別は色々ありそうなので。

### 20180228水曜日

- ここまでのまとめ。
	- 超基本的なコードは把握できた感じ。
		- TypeScriptでのビルド、webpackでオートリロード。
		- TODOまとめていこう。
	- ドラッグの感度がピクセルなのは良くない。

### 20180227火曜日

- 動くものができてきたので所感をメモ。

	- 売れない
		- App Store/Google Playで売るにはwebviewがWebGL対応である必要がある。
		- この前提要求は未調査ながら、かなり高いのではないかと思われる。

	- ゲーム制作環境としてはUnityには及ばない
		- これは当然。
		- キーフレームやパーティクル、モデル管理など同等のことをやろうと思ったらツールをかき集める必要がある。
		- あとなんだかんだでuGUIは優秀だった。html+cssで同等のUI表現を徹底できるかどうか……。flexbox調べなきゃかな？
		- 圧縮テクスチャとかどうやって用意すればいいんだろう。ASTC出力ツールでも探すべき？
	
	- コンパクトで軽い
		- Unityと比較するのは間違ってると思うけどw、とても快適。
			- 業務で使ってると、UnityはVSCodeとUnityを行ったり来たりするだけで謎の待ち時間が生じる……。もちろん大規模だからだろうけど。
			- コードちょっと弄ったらげんなりするコンパイル待ち。
				- もちろんTypeScriptだってプロジェクトが重くなったら辛いのかもしれないけど。
		- ビルド速度も速く簡単なプロジェクトは500kbちょっとで実現できる。
		- ブラウザですぐ配布できる良システム

	- 学習コストが低い
		- APIはUnityでも見た要素が多いようだ。解説記事もそれなり。



### 将来的なTODO

- InDeviceLog

- DI
	- UnityのZenjectをzapでやってるので、似たような設計ができるものがあると嬉しい。




`EOF`